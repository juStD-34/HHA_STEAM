<!doctype html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá Th·ªëng T∆∞ V·∫•n Ngh·ªÅ Nghi·ªáp ƒêa NƒÉng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #f1f5f9;
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .chu{
            margin-top: 77px !important;
        }

        .card {
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            background-color: #1e293b;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .step-number {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        /* Whack-a-Mole Styles */
        .hole {
            background-color: #334155;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            box-shadow: inset 0 8px 0 0 rgba(0, 0, 0, 0.5);
        }

        .mole {
            width: 80%;
            height: 80%;
            background-color: #ef4444;
            border-radius: 50%;
            position: absolute;
            top: 100%;
            left: 10%;
            transition: top 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .mole.up {
            top: 10%;
        }

        .mole::after {
            content: 'üê≠';
            font-size: 24px;
        }

        .result-highlight {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));
            border: 1px solid rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .chat-message {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .chat-message.user {
            flex-direction: row-reverse;
        }

        .chat-bubble {
            max-width: 70%;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            line-height: 1.4;
            white-space: pre-line;
        }

        .chat-message.user .chat-bubble {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border-bottom-right-radius: 0.25rem;
        }

        .chat-message.bot .chat-bubble {
            background-color: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-bottom-left-radius: 0.25rem;
        }

        .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(148, 163, 184, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        @media (max-width: 640px) {
            .chat-bubble {
                max-width: 90%;
            }
        }
    </style>
</head>

<body class="min-h-screen bg-[#0f172a] p-0 m-0">

    <!-- Hero Section (Full Width) -->
    <div class="relative w-full h-screen min-h-[650px] overflow-hidden group border-b border-white/10">
        <!-- Background Image -->
        <div class="absolute inset-0">
            <img src="{{ url_for('static', filename='img/school_overview.jpg') }}" alt="THPT A H·∫£i H·∫≠u"
                class="w-full h-full object-cover transform transition-transform duration-[20s] group-hover:scale-110">

            <!-- Light Overlay (Reduced opacity) -->
            <div class="absolute inset-0 bg-slate-900/40"></div>

            <!-- Bottom Gradient Fade -->
            <div class="absolute bottom-0 left-0 w-full h-32 bg-gradient-to-t from-[#0f172a] to-transparent"></div>
        </div>

        <!-- Hero Content -->
        <div class="relative z-10 h-full flex flex-col items-center justify-center text-center px-4">
            <div class="">
                <p
                    class="chu text-emerald-300 font-bold tracking-[0.2em] uppercase text-sm mb-4 drop-shadow-md bg-slate-900/50 inline-block px-4 py-1 rounded-full border border-emerald-500/20">
                    üè´ D·ª± √°n thu·ªôc tr∆∞·ªùng THPT A H·∫£i H·∫≠u
                </p>
                <h1 class="text-4xl md:text-7xl font-black mb-6 text-white leading-tight drop-shadow-2xl">
                    H·ªá Th·ªëng ƒê√°nh Gi√° & <br>
                    <span
                        class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-emerald-400 to-teal-400 filter drop-shadow-lg">
                        T∆∞ V·∫•n Ngh·ªÅ Nghi·ªáp
                    </span>
                </h1>

                <button onclick="scrollToTests()"
                    class="bg-emerald-500 hover:bg-emerald-400 text-slate-900 font-bold px-8 py-3 rounded-full shadow-lg shadow-emerald-500/30 transition-transform hover:-translate-y-0.5">
                    B·∫Øt ƒë·∫ßu kh√°m ph√° b·∫£n th√¢n
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content Container -->
    <div id="test-section" class="max-w-4xl mx-auto space-y-8 p-4 md:p-8 mt-8 relative z-20">

        <!-- Rules Section -->
        <div class="card p-6 rounded-2xl fade-in">
            <div class="flex items-center gap-3 mb-4">
                <span class="text-2xl">üìã</span>
                <h2 class="text-xl font-bold">Quy Tr√¨nh Ki·ªÉm Tra</h2>
            </div>
            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-slate-900/50 p-4 rounded-xl border border-slate-700">
                    <h3 class="font-bold text-blue-400 mb-2">B√†i 1: Kh√©o L√©o & Ki√™n Nh·∫´n</h3>
                    <p class="text-sm text-slate-300 leading-relaxed">
                        S·ª≠ d·ª•ng b·ªô thi·∫øt b·ªã <strong>Wire Loop</strong>. Di chuy·ªÉn tay c·∫ßm kim lo·∫°i t·ª´ ƒëi·ªÉm A ƒë·∫øn C m√†
                        kh√¥ng ch·∫°m v√†o ƒë∆∞·ªùng d√¢y.
                        <br>
                        üéØ <strong>M·ª•c ti√™u:</strong> Th·ªùi gian ng·∫Øn nh·∫•t + S·ªë l·∫ßn ch·∫°m √≠t nh·∫•t.
                    </p>
                </div>
                <div class="bg-slate-900/50 p-4 rounded-xl border border-slate-700">
                    <h3 class="font-bold text-yellow-500 mb-2">B√†i 2: T·ªëc ƒê·ªô Ph·∫£n X·∫°</h3>
                    <p class="text-sm text-slate-300 leading-relaxed">
                        Ch∆°i game <strong>ƒê·∫≠p Chu·ªôt</strong> ngay tr√™n m√†n h√¨nh. Chu·ªôt s·∫Ω xu·∫•t hi·ªán ng·∫´u nhi√™n trong 10
                        gi√¢y.
                        <br>
                        ‚ö° <strong>M·ª•c ti√™u:</strong> ƒê·∫≠p tr√∫ng c√†ng nhi·ªÅu chu·ªôt c√†ng t·ªët.
                    </p>
                </div>
            </div>
        </div>

        <!-- Game 1: Wire Loop -->
        <div class="card p-6 rounded-2xl fade-in border-l-4 border-blue-500 relative overflow-hidden" id="step1-card">
            <div class="absolute top-0 right-0 p-4 opacity-5 text-9xl font-black">1</div>
            <div class="flex items-center gap-4 mb-6 relative z-10">
                <div class="step-number">1</div>
                <div>
                    <h2 class="text-xl font-bold text-white">Ki·ªÉm Tra Kh√©o L√©o (Wire Loop)</h2>
                    <p class="text-slate-400 text-sm">K·∫øt n·ªëi v·ªõi thi·∫øt b·ªã ESP32 ho·∫∑c nh·∫≠p th·ªß c√¥ng</p>
                </div>
            </div>

            <!-- Live Monitor UI -->
            <div id="live-monitor" class="hidden mb-6 bg-slate-900/80 p-6 rounded-xl border border-blue-500/30">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-blue-400 font-bold uppercase tracking-wider text-xs">‚óè ƒêang k·∫øt n·ªëi thi·∫øt
                        b·ªã</span>
                    <span class="text-slate-500 text-xs font-mono">LIVE DATA</span>
                </div>
                <div class="grid grid-cols-2 gap-8 text-center">
                    <div>
                        <div class="text-slate-400 text-xs mb-1">Th·ªùi Gian</div>
                        <div class="text-3xl font-mono font-bold text-white"><span id="live-time">0.0</span>s</div>
                    </div>
                    <div>
                        <div class="text-slate-400 text-xs mb-1">S·ªë L·ªói</div>
                        <div class="text-3xl font-mono font-bold text-red-500" id="live-errors">0</div>
                    </div>
                </div>
            </div>

            <!-- Step 1 Result Display (Auto-filled) -->
            <div id="step1-result-display" class="hidden mb-6 bg-slate-800 p-6 rounded-xl border border-emerald-500/50">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-emerald-400 font-bold uppercase tracking-wider text-sm">‚úÖ K·∫øt qu·∫£ t·ª´ thi·∫øt
                        b·ªã</span>
                    <button onclick="resetStep1()" class="text-slate-400 text-xs hover:text-white underline">Nh·∫≠p l·∫°i
                        th·ªß c√¥ng</button>
                </div>
                <div class="grid grid-cols-2 gap-8 text-center">
                    <div>
                        <div class="text-slate-400 text-xs mb-1">Th·ªùi Gian</div>
                        <div class="text-3xl font-mono font-bold text-white"><span id="display-time">0.0</span>s</div>
                    </div>
                    <div>
                        <div class="text-slate-400 text-xs mb-1">S·ªë L·ªói</div>
                        <div class="text-3xl font-mono font-bold text-red-500" id="display-errors">0</div>
                    </div>
                </div>
            </div>

            <!-- Manual Input Form -->
            <div id="step1-manual-form">
                <div class="mb-4">
                    <p class="text-slate-400 text-sm italic border-l-2 border-slate-600 pl-3">
                        * N·∫øu kh√¥ng k·∫øt n·ªëi thi·∫øt b·ªã IoT, h√£y nh·∫≠p k·∫øt qu·∫£ th·ªß c√¥ng v√†o b√™n d∆∞·ªõi:
                    </p>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-medium text-slate-400 mb-1">Th·ªùi gian (gi√¢y)</label>
                        <input type="number" id="input-time"
                            class="w-full bg-slate-900/50 border border-slate-700 rounded-lg p-3 text-white focus:border-blue-500 focus:outline-none transition-colors"
                            placeholder="0.0">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-slate-400 mb-1">S·ªë l·∫ßn ch·∫°m (l·ªói)</label>
                        <input type="number" id="input-errors"
                            class="w-full bg-slate-900/50 border border-slate-700 rounded-lg p-3 text-white focus:border-blue-500 focus:outline-none transition-colors"
                            placeholder="0">
                    </div>
                </div>
                <div class="mt-4 flex flex-col gap-3 sm:flex-row sm:items-center">
                    <button onclick="submitWireLoopResult()" id="wire-submit-btn"
                        class="bg-blue-600 hover:bg-blue-500 text-white font-semibold px-5 py-3 rounded-lg transition shadow-lg shadow-blue-600/30 w-full sm:w-auto text-center">
                        G·ª≠i k·∫øt qu·∫£ Wire Loop
                    </button>
                    <p id="step1-api-message" class="hidden text-sm text-emerald-400">ƒê√£ c·∫≠p nh·∫≠t k·∫øt qu·∫£.</p>
                </div>
            </div>

            <div id="step1-status"
                class="mt-4 hidden p-3 bg-emerald-500/10 border border-emerald-500/20 rounded-lg flex items-center gap-2 text-emerald-500 text-sm font-bold">
                <span>‚úÖ ƒê√£ ghi nh·∫≠n k·∫øt qu·∫£ B∆∞·ªõc 1!</span>
            </div>
        </div>

        <!-- Game 2: Whack-a-Mole -->
        <div class="card p-6 rounded-2xl fade-in border-l-4 border-yellow-500 relative overflow-hidden" id="step2-card">
            <div class="absolute top-0 right-0 p-4 opacity-5 text-9xl font-black">2</div>
            <div class="flex items-center gap-4 mb-6 relative z-10">
                <div class="step-number bg-gradient-to-br from-yellow-500 to-orange-500 !shadow-yellow-500/50">2</div>
                <div>
                    <h2 class="text-xl font-bold text-white">Ki·ªÉm Tra Ph·∫£n X·∫° (ƒê·∫≠p Chu·ªôt)</h2>
                    <p class="text-slate-400 text-sm">Nh·∫•n "B·∫Øt ƒê·∫ßu" v√† ch∆°i trong 10 gi√¢y</p>
                </div>
            </div>

            <div class="flex flex-col md:flex-row gap-6">
                <!-- Game Board -->
                <div class="flex-1">
                    <div
                        class="grid grid-cols-3 gap-3 bg-slate-900 p-4 rounded-xl border border-slate-700 max-w-[300px] mx-auto">
                        <div class="hole w-16 h-16 sm:w-20 sm:h-20" data-index="0">
                            <div class="mole"></div>
                        </div>
                        <div class="hole w-16 h-16 sm:w-20 sm:h-20" data-index="1">
                            <div class="mole"></div>
                        </div>
                        <div class="hole w-16 h-16 sm:w-20 sm:h-20" data-index="2">
                            <div class="mole"></div>
                        </div>
                        <div class="hole w-16 h-16 sm:w-20 sm:h-20" data-index="3">
                            <div class="mole"></div>
                        </div>
                        <div class="hole w-16 h-16 sm:w-20 sm:h-20" data-index="4">
                            <div class="mole"></div>
                        </div>
                        <div class="hole w-16 h-16 sm:w-20 sm:h-20" data-index="5">
                            <div class="mole"></div>
                        </div>
                        <div class="hole w-16 h-16 sm:w-20 sm:h-20" data-index="6">
                            <div class="mole"></div>
                        </div>
                        <div class="hole w-16 h-16 sm:w-20 sm:h-20" data-index="7">
                            <div class="mole"></div>
                        </div>
                        <div class="hole w-16 h-16 sm:w-20 sm:h-20" data-index="8">
                            <div class="mole"></div>
                        </div>
                    </div>
                </div>

                <!-- Info & Controls -->
                <div class="flex-1 flex flex-col justify-center space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-slate-900/50 p-3 rounded-lg text-center border border-slate-700">
                            <span class="block text-xs text-slate-400">Th·ªùi gian</span>
                            <span id="game-time" class="text-2xl font-bold text-blue-400">10</span>s
                        </div>
                        <div class="bg-slate-900/50 p-3 rounded-lg text-center border border-slate-700">
                            <span class="block text-xs text-slate-400">ƒêi·ªÉm S·ªë</span>
                            <span id="game-score" class="text-2xl font-bold text-yellow-500">0</span>
                        </div>
                    </div>
                    <button onclick="startGame()" id="start-game-btn"
                        class="w-full bg-yellow-500 hover:bg-yellow-600 text-slate-900 font-bold py-3 px-6 rounded-xl transition-all shadow-lg shadow-yellow-500/20 active:scale-95">
                        B·∫Øt ƒê·∫ßu Ch∆°i
                    </button>
                    <div id="step2-status"
                        class="hidden p-3 bg-emerald-500/10 border border-emerald-500/20 rounded-lg flex items-center gap-2 text-emerald-500 text-sm font-bold">
                        <span>‚úÖ ƒê√£ ho√†n th√†nh!</span>
                    </div>
                    <div class="bg-slate-900/40 p-4 rounded-xl border border-slate-700 space-y-3">
                        <p class="text-sm text-slate-300 font-semibold">Ho·∫∑c nh·∫≠p k·∫øt qu·∫£ th·ªß c√¥ng:</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            <div>
                                <label class="block text-xs font-medium text-slate-400 mb-1">Th·ªùi gian (gi√¢y)</label>
                                <input type="number" id="reflex-time-input"
                                    class="w-full bg-slate-900/60 border border-slate-700 rounded-lg p-3 text-white focus:border-yellow-400 focus:outline-none"
                                    placeholder="10">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-slate-400 mb-1">S·ªë chu·ªôt ƒë√£ ƒë·∫≠p</label>
                                <input type="number" id="reflex-quantity-input"
                                    class="w-full bg-slate-900/60 border border-slate-700 rounded-lg p-3 text-white focus:border-yellow-400 focus:outline-none"
                                    placeholder="0">
                            </div>
                        </div>
                        <div class="flex flex-col gap-3 sm:flex-row sm:items-center">
                            <button onclick="submitReflexResult()" id="reflex-submit-btn"
                                class="bg-yellow-500 hover:bg-yellow-400 text-slate-900 font-semibold px-5 py-3 rounded-lg transition shadow-lg shadow-yellow-500/30 w-full sm:w-auto text-center">
                                G·ª≠i k·∫øt qu·∫£ ph·∫£n x·∫°
                            </button>
                            <p id="step2-api-message" class="hidden text-sm text-emerald-400">ƒê√£ c·∫≠p nh·∫≠t k·∫øt qu·∫£.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Consultation Section -->
        <div class="card p-6 rounded-2xl fade-in border-l-4 border-emerald-500 relative overflow-hidden">
            <div class="absolute top-0 right-0 p-4 opacity-5 text-9xl font-black">3</div>
            <div class="flex items-center gap-4 mb-6 relative z-10">
                <div class="step-number bg-gradient-to-br from-emerald-500 to-teal-500 !shadow-emerald-500/50">3</div>
                <div>
                    <h2 class="text-xl font-bold text-white">Tr√≤ Chuy·ªán V·ªõi Chuy√™n Gia</h2>
                    <p class="text-slate-400 text-sm">ƒê·∫∑t c√¢u h·ªèi v√† nh·∫≠n t∆∞ v·∫•n c√° nh√¢n h√≥a</p>
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-4 relative z-10">
                <div class="space-y-4">
                    <div class="chat-message bot">
                        <div class="chat-avatar">ü§ñ</div>
                        <div class="chat-bubble bg-slate-900/80 border border-slate-700">Ch√†o b·∫°n! B·∫°n mu·ªën ph√°t tri·ªÉn k·ªπ nƒÉng n√†o sau b√†i ki·ªÉm tra?</div>
                    </div>
                    <div class="chat-message user">
                        <div class="chat-bubble bg-blue-600 text-white border-0">Em mu·ªën bi·∫øt ng√†nh n√†o ph√π h·ª£p v·ªõi kh·∫£ nƒÉng ph·∫£n x·∫° t·ªët.</div>
                        <div class="chat-avatar">üßë</div>
                    </div>
                    <div class="chat-message bot">
                        <div class="chat-avatar">ü§ñ</div>
                        <div class="chat-bubble bg-slate-900/80 border border-slate-700">Nh·ªØng ng√†nh nh∆∞ k·ªπ thu·∫≠t ƒëi·ªÅu khi·ªÉn, logistics, ƒëi·ªÅu ph·ªëi vi√™n l√† l·ª±a ch·ªçn tuy·ªát v·ªùi!</div>
                    </div>
                </div>
                <div class="flex flex-col justify-between bg-slate-900/50 border border-slate-700 rounded-2xl p-5">
                    <p class="text-slate-300 text-sm leading-relaxed mb-4">
                        H√£y tr√≤ chuy·ªán v·ªõi chuy√™n gia AI ƒë·ªÉ nh·∫≠n ph√¢n t√≠ch s√¢u h∆°n v·ªÅ k·∫øt qu·∫£ c·ªßa b·∫°n, l·ªô tr√¨nh ngh·ªÅ nghi·ªáp,
                        c≈©ng nh∆∞ nh·ªØng k·ªπ nƒÉng c·∫ßn r√®n luy·ªán ti·∫øp theo.
                    </p>
                    <button onclick="openChatModal()"
                        class="bg-emerald-500 hover:bg-emerald-400 text-slate-900 font-bold px-6 py-3 rounded-xl shadow-lg shadow-emerald-500/20 transition-all">
                        M·ªü khung tr√≤ chuy·ªán
                    </button>
                </div>
            </div>
        </div>
<!-- 
        <div class="flex items-center gap-3 text-sm text-emerald-300 bg-slate-900/50 border border-emerald-500/20 rounded-xl px-4 py-3">
            <span class="relative flex h-3 w-3">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                <span class="relative inline-flex rounded-full h-3 w-3 bg-emerald-500"></span>
            </span>
            ƒê·ªô ch√≠nh x√°c AI: {{ accuracy }}%
        </div> -->

        <!-- Final Result Section -->
        <button onclick="getFinalAdvice()" id="get-result-btn"
            class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white p-4 rounded-xl text-lg font-bold shadow-xl shadow-blue-500/20 transition-all transform hover:-translate-y-1 opacity-50 cursor-not-allowed">
            üìä Ph√¢n T√≠ch & Xem K·∫øt Qu·∫£
        </button>

        <div id="result-card"
            class="bg-gradient-to-br from-slate-800 to-slate-900 p-8 rounded-2xl shadow-2xl border border-slate-700 hidden">
            <h2
                class="text-3xl font-bold text-center mb-8 bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-emerald-400">
                K·∫øt Qu·∫£ Ph√¢n T√≠ch</h2>

            <div class="flex flex-col md:flex-row gap-8 mb-8">
                <div class="flex-1 text-center p-6 bg-slate-800/50 rounded-xl border border-slate-700">
                    <div class="text-sm text-slate-400 mb-2">Nh√≥m T√≠nh C√°ch</div>
                    <div id="group-result" class="text-5xl font-black text-white mb-2">?</div>
                    <div id="desc-result" class="text-emerald-400 font-medium">--</div>
                </div>

                <div class="flex-[1.5]">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                        <span class="text-blue-500">üöÄ</span> Ngh·ªÅ Nghi·ªáp ƒê·ªÅ Xu·∫•t
                    </h3>
                    <ul id="career-list" class="space-y-3">
                        <!-- Items injected by JS -->
                    </ul>
                </div>
            </div>
        </div>

    </div>

    <!-- Floating Chat Button -->
    <div class="fixed bottom-6 right-6 z-40">
        <button onclick="openChatModal()" id="chat-open-btn"
            class="bg-emerald-500 hover:bg-emerald-400 text-slate-900 font-semibold px-5 py-3 rounded-full shadow-lg shadow-emerald-500/30 flex items-center gap-2">
            üí¨ Chat v·ªõi AI
        </button>
    </div>

    <!-- Chat Modal -->
    <div id="chat-modal" class="hidden fixed inset-0 bg-slate-900/70 backdrop-blur-sm z-40">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="w-full max-w-lg bg-slate-900 border border-white/10 rounded-2xl shadow-2xl relative">
                <div class="flex items-center justify-between p-4 border-b border-white/10">
                    <div class="flex items-center gap-3">
                        <div class="chat-avatar bg-emerald-500/20 border border-emerald-400/30 text-emerald-300">
                            ü§ñ
                        </div>
                        <div>
                            <p class="text-sm text-emerald-300 uppercase font-semibold">AI Career Assistant</p>
                            <p class="text-xs text-slate-400">H·ªèi t√¥i b·∫•t c·ª© ƒëi·ªÅu g√¨ v·ªÅ h·ªá th·ªëng</p>
                        </div>
                    </div>
                    <button onclick="closeChatModal()"
                        class="text-slate-400 hover:text-white transition-colors text-xl">&times;</button>
                </div>
                <div class="p-4 max-h-[60vh] overflow-y-auto" id="chat-messages">
                    <!-- Messages injected via JS -->
                </div>
                <div class="p-4 border-t border-white/10 bg-slate-900/80">
                    <div class="flex items-center gap-2">
                        <textarea id="chat-input"
                            class="flex-1 bg-slate-800/80 border border-slate-700 rounded-xl p-3 text-sm text-white resize-none focus:outline-none focus:border-emerald-400 h-16"
                            placeholder="Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n... (Enter ƒë·ªÉ g·ª≠i)"></textarea>
                        <button id="chat-send-btn" onclick="sendChatMessage()"
                            class="bg-emerald-500 hover:bg-emerald-400 text-slate-900 font-semibold px-4 py-3 rounded-xl transition disabled:opacity-50 disabled:cursor-not-allowed">G·ª≠i</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script> -->
    <script>
        // State
        let wireLoopResult = { time: 0, errors: 0, done: false };
        let whackResult = { score: 0, done: false };
        let lastTimestamp = 0;
        let chatInitialized = false;
        let chatWaiting = false;

        const chatModal = document.getElementById('chat-modal');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const chatSendBtn = document.getElementById('chat-send-btn');
        const step1MessageEl = document.getElementById('step1-api-message');
        const step2MessageEl = document.getElementById('step2-api-message');
        const reflexTimeInput = document.getElementById('reflex-time-input');
        const reflexQuantityInput = document.getElementById('reflex-quantity-input');

        // --- Socket.IO Connection (Step 1) ---
        // const socket = io();

        // socket.on('connect', () => {
        //     console.log('Connected to WebSocket server');
        // });

        // socket.on('disconnect', () => {
        //     console.log('Disconnected from server');
        // });

        // socket.on('game_update', (data) => {
        //     if (data && data.status !== 'idle') {
        //         if (data.status === 'playing') {
        //             document.getElementById('live-monitor').classList.remove('hidden');
        //             document.getElementById('step1-manual-form').classList.remove('hidden');
        //             document.getElementById('step1-result-display').classList.add('hidden');
        //
        //             document.getElementById('live-time').innerText = data.time.toFixed(1);
        //             document.getElementById('live-errors').innerText = data.errors;
        //         }
        //         else if (data.status === 'finished' && data.timestamp > lastTimestamp) {
        //             lastTimestamp = data.timestamp;
        //
        //             // Lock Step 1
        //             document.getElementById('input-time').value = data.time;
        //             document.getElementById('input-errors').value = data.errors;
        //
        //             document.getElementById('display-time').innerText = data.time;
        //             document.getElementById('display-errors').innerText = data.errors;
        //             wireLoopResult.time = data.time;
        //             wireLoopResult.errors = data.errors;
        //
        //             document.getElementById('live-monitor').classList.add('hidden');
        //             document.getElementById('step1-manual-form').classList.add('hidden');
        //             document.getElementById('step1-result-display').classList.remove('hidden');
        //
        //             updateStep1Status(true);
        //         }
        //     }
        // });

        // Manual Input Listener Step 1
        const inputTime = document.getElementById('input-time');
        const inputErrors = document.getElementById('input-errors');
        function onManualInput() {
            if (inputTime.value !== '' && inputErrors.value !== '') {
                updateStep1Status(true);
            } else {
                updateStep1Status(false);
            }
        }
        inputTime.addEventListener('input', onManualInput);
        inputErrors.addEventListener('input', onManualInput);

        function setInlineMessage(el, text, isError = false) {
            if (!el) return;
            el.textContent = text;
            el.classList.remove('hidden');
            el.classList.toggle('text-emerald-400', !isError);
            el.classList.toggle('text-red-400', isError);
        }

        function clearInlineMessage(el) {
            if (!el) return;
            el.classList.add('hidden');
        }

        async function submitWireLoopResult() {
            const submitBtn = document.getElementById('wire-submit-btn');
            const timeVal = parseFloat(inputTime.value);
            const errorVal = parseInt(inputErrors.value);
            if (isNaN(timeVal) || isNaN(errorVal)) {
                setInlineMessage(step1MessageEl, "Vui l√≤ng nh·∫≠p ƒë·ªß th·ªùi gian v√† s·ªë l·ªói.", true);
                return;
            }
            setInlineMessage(step1MessageEl, "‚è≥ ƒêang g·ª≠i k·∫øt qu·∫£...", false);
            submitBtn.disabled = true;
            submitBtn.classList.add('opacity-70', 'cursor-not-allowed');
            try {
                const response = await fetch('/api/game_event', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ event: 'finish', time: timeVal, errors: errorVal })
                });
                const data = await response.json();
                if (!response.ok || data.error) {
                    throw new Error(data.error || 'Kh√¥ng th·ªÉ l∆∞u k·∫øt qu·∫£.');
                }
                wireLoopResult.time = timeVal;
                wireLoopResult.errors = errorVal;
                updateStep1Status(true);
                setInlineMessage(step1MessageEl, "‚úÖ ƒê√£ g·ª≠i k·∫øt qu·∫£ Wire Loop!", false);
            } catch (err) {
                setInlineMessage(step1MessageEl, err.message || 'C√≥ l·ªói x·∫£y ra.', true);
            } finally {
                submitBtn.disabled = false;
                submitBtn.classList.remove('opacity-70', 'cursor-not-allowed');
            }
        }

        function updateStep1Status(isDone) {
            wireLoopResult.done = isDone;
            document.getElementById('step1-status').classList.toggle('hidden', !isDone);
            checkAllDone();
        }

        function resetStep1() {
            document.getElementById('step1-result-display').classList.add('hidden');
            document.getElementById('step1-manual-form').classList.remove('hidden');
            document.getElementById('input-time').value = '';
            document.getElementById('input-errors').value = '';
            clearInlineMessage(step1MessageEl);
            updateStep1Status(false);
        }

        // --- Whack-a-Mole Game Logic (Step 2) ---
        const holes = document.querySelectorAll('.hole');
        const scoreBoard = document.querySelector('#game-score');
        const timeDisplay = document.querySelector('#game-time');
        const startBtn = document.querySelector('#start-game-btn');
        let lastHole, timeUp = false, score = 0, timeLeft = 10, countdownInterval;

        function randomTime(min, max) { return Math.round(Math.random() * (max - min) + min); }
        function randomHole(holes) {
            const idx = Math.floor(Math.random() * holes.length);
            const hole = holes[idx];
            if (hole === lastHole) return randomHole(holes);
            lastHole = hole;
            return hole;
        }
        function peep() {
            const time = randomTime(400, 900);
            const hole = randomHole(holes);
            const mole = hole.querySelector('.mole');
            mole.classList.add('up');
            setTimeout(() => {
                mole.classList.remove('up');
                if (!timeUp) peep();
            }, time);
        }
        function startGame() {
            if (countdownInterval) clearInterval(countdownInterval);
            scoreBoard.textContent = 0; timeDisplay.textContent = 10;
            timeUp = false; score = 0; timeLeft = 10;

            startBtn.disabled = true; startBtn.classList.add('opacity-50', 'cursor-not-allowed');
            startBtn.innerText = "ƒêang ch∆°i...";
            document.getElementById('step2-status').classList.add('hidden');

            peep();

            countdownInterval = setInterval(() => {
                timeLeft--;
                timeDisplay.textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    timeUp = true;
                    startBtn.disabled = false; startBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    startBtn.innerText = "Ch∆°i L·∫°i";

                    whackResult.score = score;
                    whackResult.done = true;
                    document.getElementById('step2-status').classList.remove('hidden');
                    saveReflexResult(10, score).catch(err => console.warn('Reflex sync failed', err));
                    checkAllDone();
                }
            }, 1000);
        }

        async function saveReflexResult(timeVal, quantityVal) {
            const response = await fetch('/api/reflex_result', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ time: timeVal, quantity: quantityVal })
            });
            const data = await response.json();
            if (!response.ok || data.error) {
                throw new Error(data.error || 'Kh√¥ng th·ªÉ l∆∞u k·∫øt qu·∫£ ph·∫£n x·∫°.');
            }
        }

        function bonk(e) {
            if (!e.isTrusted) return;
            const mole = this.querySelector('.mole');
            if (mole.classList.contains('up')) {
                score++;
                mole.classList.remove('up');
                scoreBoard.textContent = score;
                this.classList.add('scale-95');
                setTimeout(() => this.classList.remove('scale-95'), 100);
            }
        }
        holes.forEach(hole => hole.addEventListener('mousedown', bonk));
        holes.forEach(hole => hole.addEventListener('touchstart', (e) => { e.preventDefault(); bonk.call(hole, e); }));

        async function submitReflexResult() {
            const btn = document.getElementById('reflex-submit-btn');
            const timeVal = parseFloat(reflexTimeInput.value);
            const quantityVal = parseInt(reflexQuantityInput.value);
            if (isNaN(timeVal) || isNaN(quantityVal)) {
                setInlineMessage(step2MessageEl, "Vui l√≤ng nh·∫≠p ƒë·ªß th·ªùi gian v√† s·ªë chu·ªôt.", true);
                return;
            }
            setInlineMessage(step2MessageEl, "‚è≥ ƒêang g·ª≠i k·∫øt qu·∫£...", false);
            btn.disabled = true;
            btn.classList.add('opacity-70', 'cursor-not-allowed');
            try {
                await saveReflexResult(timeVal, quantityVal);
                whackResult.score = quantityVal;
                whackResult.done = true;
                scoreBoard.textContent = quantityVal;
                timeDisplay.textContent = timeVal;
                document.getElementById('step2-status').classList.remove('hidden');
                checkAllDone();
                setInlineMessage(step2MessageEl, "‚úÖ ƒê√£ g·ª≠i k·∫øt qu·∫£ ph·∫£n x·∫°!", false);
            } catch (err) {
                setInlineMessage(step2MessageEl, err.message || 'C√≥ l·ªói x·∫£y ra.', true);
            } finally {
                btn.disabled = false;
                btn.classList.remove('opacity-70', 'cursor-not-allowed');
            }
        }

        function scrollToTests() {
            const section = document.getElementById('test-section');
            if (section) {
                section.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // --- Final Submission ---
        function checkAllDone() {
            const btn = document.getElementById('get-result-btn');
            if (wireLoopResult.done && whackResult.done) {
                btn.classList.remove('opacity-50', 'cursor-not-allowed');
                btn.disabled = false;
            } else {
                btn.classList.add('opacity-50', 'cursor-not-allowed');
                btn.disabled = true;
            }
        }

        async function getFinalAdvice() {
            const t = parseFloat(document.getElementById('input-time').value);
            const e = parseInt(document.getElementById('input-errors').value);
            const s = whackResult.score;

            if (isNaN(t) || isNaN(e)) {
                alert("Vui l√≤ng ki·ªÉm tra l·∫°i k·∫øt qu·∫£ b√†i 1!");
                return;
            }

            try {
                document.getElementById('get-result-btn').innerText = "‚è≥ ƒêang ph√¢n t√≠ch...";

                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ time: t, errors: e, score: s })
                });
                const data = await response.json();

                if (data.error) { alert('L·ªói: ' + data.error); return; }

                // Display
                const groupEl = document.getElementById('group-result');
                groupEl.innerText = data.group;
                groupEl.className = "text-5xl font-black mb-2 " + (data.group === 'A' ? "text-blue-500" : data.group === 'B' ? "text-emerald-500" : "text-purple-500");

                let desc = "";
                if (data.group === 'A') {
                    desc = "Ng∆∞·ªùi ƒëi·ªÅu h√†nh: Ph·∫£n x·∫° th·∫ßn t·ªëc & Ki·ªÉm so√°t t√¨nh hu·ªëng tuy·ªát v·ªùi.";
                } else if (data.group === 'B') {
                    desc = "Ngh·ªá nh√¢n: ƒê√¥i tay kh√©o l√©o, t·ªâ m·ªâ & S·ª± t·∫≠p trung b·ªÅn b·ªâ.";
                } else {
                    desc = "Nh√† chi·∫øn l∆∞·ª£c: Thi√™n h∆∞·ªõng T∆∞ duy qu·∫£n l√Ω & Ph√¢n t√≠ch (√≠t thi√™n v·ªÅ thao t√°c).";
                }
                document.getElementById('desc-result').innerText = desc;

                const list = document.getElementById('career-list');
                list.innerHTML = '';
                data.careers.forEach(c => {
                    list.innerHTML += `<li class="p-3 bg-slate-900 rounded-lg border border-slate-700 flex items-center gap-3">
                        <span class="w-2 h-2 rounded-full bg-blue-500"></span>${c}
                    </li>`
                });

                document.getElementById('result-card').classList.remove('hidden');
                document.getElementById('result-card').scrollIntoView({ behavior: "smooth" });

                document.getElementById('get-result-btn').innerText = "üìä Ph√¢n T√≠ch & Xem K·∫øt Qu·∫£";

            } catch (err) {
                console.error(err);
                alert('L·ªói k·∫øt n·ªëi server!');
                document.getElementById('get-result-btn').innerText = "üìä Ph√¢n T√≠ch & Xem K·∫øt Qu·∫£";
            }
        }

        // --- Chatbot Modal ---
        function openChatModal() {
            chatModal.classList.remove('hidden');
            if (!chatInitialized) {
                appendChatMessage('bot', 'Xin ch√†o! T√¥i c√≥ th·ªÉ gi·∫£i ƒë√°p th·∫Øc m·∫Øc v·ªÅ quy tr√¨nh ki·ªÉm tra v√† g·ª£i √Ω ngh·ªÅ nghi·ªáp.');
                chatInitialized = true;
            }
            setTimeout(() => chatInput.focus(), 100);
        }

        function closeChatModal() {
            chatModal.classList.add('hidden');
        }

        function sanitizeMarkdownEmphasis(input) {
            return input.replace(/\*\*(.*?)\*\*/g, '$1');
        }

        function appendChatMessage(role, text) {
            const wrapper = document.createElement('div');
            wrapper.className = `chat-message ${role}`;

            const avatar = document.createElement('div');
            avatar.className = 'chat-avatar';
            avatar.textContent = role === 'bot' ? 'ü§ñ' : 'üßë';

            const bubble = document.createElement('div');
            bubble.className = 'chat-bubble';
            bubble.textContent = sanitizeMarkdownEmphasis(text);

            if (role === 'user') {
                wrapper.appendChild(bubble);
                wrapper.appendChild(avatar);
            } else {
                wrapper.appendChild(avatar);
                wrapper.appendChild(bubble);
            }

            chatMessages.appendChild(wrapper);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function setChatLoading(state) {
            chatWaiting = state;
            chatSendBtn.disabled = state;
            chatSendBtn.textContent = state ? 'ƒêang tr·∫£ l·ªùi...' : 'G·ª≠i';
        }

        async function sendChatMessage() {
            if (chatWaiting) return;
            const message = chatInput.value.trim();
            if (!message) return;

            appendChatMessage('user', message);
            chatInput.value = '';
            setChatLoading(true);

            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message })
                });
                const data = await response.json();
                if (data.error) {
                    appendChatMessage('bot', 'Xin l·ªói, t√¥i ch∆∞a nh·∫≠n ƒë∆∞·ª£c c√¢u h·ªèi. Vui l√≤ng th·ª≠ l·∫°i nh√©!');
                } else {
                    appendChatMessage('bot', data.reply);
                }
            } catch (err) {
                console.error(err);
                appendChatMessage('bot', 'C√≥ l·ªói k·∫øt n·ªëi. B·∫°n th·ª≠ l·∫°i sau nh√©!');
            } finally {
                setChatLoading(false);
            }
        }

        chatInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendChatMessage();
            }
        });

    </script>
</body>

</html>
